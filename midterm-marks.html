<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kageyo TVET — Mid-Term Marks Management</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="32x32" href="kageyo-logo.jpg">
  <style>
    .card { border-radius: .75rem; box-shadow: 0 8px 24px rgba(2,6,23,0.06); }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .year-box { cursor: pointer; }
    .year-box:hover { background-color: #eff6ff; }
    .hidden { display: none; }
    .term-nav-btn { transition: all 0.2s; }
    .term-nav-btn.active { background-color: #2563eb; color: white; }
  </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
  <!-- HEADER / NAVBAR -->
  <header class="bg-white shadow-sm">
    <div class="bg-blue-600 text-white py-2">
      <div class="container mx-auto px-4 flex justify-between items-center">
        <a href="#" class="hover:underline"><i class="fab fa-whatsapp mr-2"></i>Join WhatsApp Group</a>
        <select id="header-language-selector" class="p-1 rounded bg-white text-blue-600">
          <option value="en">English</option>
          <option value="rw">Kinyarwanda</option>
          <option value="fr">Français</option>
        </select>
      </div>
    </div>

    <div class="container mx-auto px-4 py-4">
      <nav class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href='index.html'>
            <img src="kageyo-logo.jpg" alt="Kageyo TVET School Logo" class="w-16 h-16 object-cover rounded-full shadow-sm">
          </a>
          <div>
            <a class='text-xl font-bold text-blue-600' href='/'>KAGEYO TVET SCHOOL</a>
            <div class="text-sm text-gray-500">Work - Courage - Solidarity</div>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a class='text-blue-600 hover:text-blue-800' href='/'>Home</a>
          <a class='text-blue-600 hover:text-blue-800' href='/about'>About Us</a>
          <a href="student-data.html" class="text-blue-600 hover:text-blue-800">Student Portal</a>
          <a href="admin-dashboard.html" class="text-blue-600 hover:text-blue-800">Marks Management</a>
          <a class='text-blue-600 hover:text-blue-800' href='/contact'>Contact</a>
          <a class='px-3 py-2 bg-blue-600 text-white rounded' href='/login-new'>Login</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="container mx-auto px-4 py-6">
    <section class="card bg-white p-6">
      <div class="flex items-start justify-between">
        <div>
          <h1 class="text-xl font-bold text-blue-700">Mid-Term Marks Management</h1>
          <p class="text-sm text-gray-600">Enter mid-term marks for all students. System will calculate totals automatically.</p>
        </div>
        <div class="text-right text-sm text-gray-500">
          Academic Year: <strong>2025 - 2026</strong>
        </div>
      </div>

      <!-- Term Navigation -->
      <div class="my-4">
        <h3 class="text-sm font-semibold text-gray-700 mb-2">Select Term</h3>
        <div class="flex flex-wrap gap-2">
          <button id="midTermBtn" class="term-nav-btn px-3 py-1 rounded text-sm font-medium border border-blue-600 text-blue-600 active">
            Mid-Term
          </button>
          <button id="term1Btn" class="term-nav-btn px-3 py-1 rounded text-sm font-medium border border-blue-600 text-blue-600">
            Term 1
          </button>
          <button id="term2Btn" class="term-nav-btn px-3 py-1 rounded text-sm font-medium border border-blue-600 text-blue-600">
            Term 2
          </button>
          <button id="term3Btn" class="term-nav-btn px-3 py-1 rounded text-sm font-medium border border-blue-600 text-blue-600">
            Term 3
          </button>
          <button id="termExamBtn" class="term-nav-btn px-3 py-1 rounded text-sm font-medium border border-blue-600 text-blue-600">
            Term Exam
          </button>
        </div>
      </div>

      <!-- Search Box -->
      <div class="my-4">
        <input type="text" id="studentSearch" placeholder="Search student by name..." 
               class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600">
        <div id="searchResults" class="mt-2"></div>
      </div>

      <hr class="my-4" />

      <!-- Classes list -->
      <div id="classesContainer" class="space-y-4 max-h-[70vh] overflow-auto pr-2">
        <!-- Populated by JS -->
      </div>

      <!-- Save and Publish buttons -->
      <div class="p-4 mt-4 border-t">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-700">Click the button below to save all changes.</div>
          <div class="space-x-2">
            <button id="saveBtn" class="bg-green-600 text-white px-5 py-2 rounded font-semibold">Save All Changes</button>
          </div>
        </div>
        <div id="message" class="text-green-600 text-sm font-medium mt-2 hidden"></div>
      </div>
    </section>
  </main>

  <!-- SCRIPT -->
  <script>
    // Initial student data (same as in admin-dashboard)
    const initial = {
      "S1A": ["ABEREYIMANA James","ABIMANA HIRWA Gany Blessing","AHISHAKIYE MANZI Aime Miguel","ASHIMWE Nate Brayan","Benedicto King Samuel","BUGINGO BEZA Keny","GASHUMBA NDAYISHIMIYE KIM Kenedy","IGENUKWISHATSE BYISHIMO Jean Maurice","IGIRANEZA CYUSA Milton","IHUMURE NSENGIYUMVA Heroine","INEZA Queen Deborah","IRABARUTA MUGISHA Credo","IRAKOZE Belle Amie","IRAKOZE Janviere","IRAKOZE Yanis","ISHIMWE UWASE Gabriella","ISIMBI UWASE Joyeuse","ITANGANEZA Parfait","KAMIKAZI Patience","MUNEZERO Enock","MUNEZERO Priscilla","MUTONIWASE Benitha","MUVUNYI UWIMPUHWE Benie Hortance","MWITENEZA Jean Pierre","NDARUHUTSE Danny","NGABONZIZA MUGISHA Boris","NGANZO Born Bercee","RORIRORA Gihozo Anella","UWANYAGASANI Cedrick","UWASE Benitha","UWIDUHAYE Pascaline","UWINEZA AKALIZA Martina","UWIZEYIMANA Valentine","YUBAHWE Anitha"],
      "S1B": ["ABAYISENGA Emmu Shalom","AMANI NSHUTI Claver","ARERWENEZA Laetitia","BAGABE Dieudonne","CYOMORO Nicky Prince","GAGA Lioness","IGANZE Olla Mireille","IGIRIMBABAZI Pamella","INEZA Aure Alexandrine","INEZA Deborah","INEZA KAMIKAZI TETA Promesse","IRAGENA Gloria","IRAGENA Laetitia","IRAME MUCYO Angelo","ISHEMA Rayan","ISHIMWE NGABO Hertier","ISHIMWE Olga","ISINGIZWE Ange Afurika Maombe","KAYITARE Caleb","KEZA UMI Abdoulatomani","KUNDA Beny Bienaime","KWIZERA MUHOZA Prince","MANZI Boaz","MBABAZI Blessed","MUNEZERO Gentil Hertier","MUNEZERO Yvette","MUTONIWASE Esther","NDIKUMWENAYO Jeannette","NIRAGIRE Aline","NIYONZIMA Lucky","RUDASINGWA","SHAMI Ianis Vangelis","UWASE GASARO Kelia","UWASE Sendrine","UWIZEYIMANA Chakilla","UYIZERA Regis"],
      "S2A": ["BYISHIMO Remy","BAHO AKARIZA Kevine","DUKUZUMUREMYI Janvier","GANZA AHADI TRESOR","IHIRWE Benitha","IKUNDABAYO Kevin","IMFURAYASE Aimee Ange","INEZA QUEEN LOVE","INEZA Ryan Merci","IRASUBIZA NANSI Nadia Lenatha","ISHIMWE Brianna","ISUMBINGABO HIRWA HERVE","KALIZA UNEJEJE Ella  Blassia","KAREKEZI SHIMWA SYLIVIE","KWIZE David","KWIZERA Richard","MANZI GANZA Fred","MBABAZI DORCAS","MUBIIRIGI Cyusa Prince","MUCYO MUGWANEZA Magnifique","MUSENGIMANA Marie Divine","NGABO Prince","NIYOMUKIZA STANISLAS","NIZEYIMANA Etienne","NYIRAHABAMUNGU Janviere","SHEMA NZAYITURIKI Benoit","TUYIZERE Solange","UFITEYEZU SERGE","UMUKUNDWA QUEEN VANESSA","UWAMASHIMWE JEANNETTE","UWASE Fabiola","UWIMANA Fideline","UWIMPUHWE JEROME","UWIZEYIMANA Patrick"],
      "S2B": ["ABE MUGISHA Antoine","ABIJURU Gift Kelly Joel","AGASARO Liza Briante","CYOMORO NIYONZIMA Iba Bright","GIRUMUGISHA MASSIMO","HERO KARENGERA Keutch","HIRWA KAZE  Danyllo","IGIHOZO Kellia","IGIKUNDIRO Fiston","IRERA PROMISE","IRIZA GWIZA Clenie","ISHIMWE  YVETTE","ISHIMWE Belyse","ISHIMWE NGABO Victory","KABANDA RUTERANA He Calvin","KAMALI IGIHOZO IRANZI Marie Mercie","KEZA SANGWA DIVINE","KWIBUKA GIFT CARTINE Arnal","MARIYAMUNGU JUDITH","MUTAGANDA Micky","NDAMUKUNDA GISA CHANELLA","NEZA LIZA Kenia","NIKWIMANIGIZE Bonheur","NIWEKARABO KELIA WIVINE","RWEMA NTETE Arthur","SEBAHIRE MUHINEZA Emmaus","TURIKUMWE LOVE MORE","TUYIZERE Mudathiru","UMWARI GATETE Christa","UWASE GIHOZO Chanella","UWINSHUTI Evelyne"],
      "S3A": ["ABAYO Samuella","BYIRINGIRO GWIZA SALOMON","IGIHOZO EVA ALLEN QUEEN","IGIZENEZA Benoit Gratus","IHIRWE FLORA","IHOZO Carine","IKUZWE TETA LEATITIA","INEZA Confiance Princesse","INEZA PIERRA","INEZA RUTAYISIRE Kellia","ISHIMWE KEVIN PRINCE","ISHIMWE NOELLA","KAYITARE Brave","MBIKESHIMANA SECONDINE","MUGANWA MAURICE","MUSHIME ISHEJA Natasha","MUYISENGE Gisele","NIWEMUGENI GENNIFER","NIYIBIZI ESPERANCE","NIYIGENA JEANNETTE","NIYO IGIRANEZA Emmanuel","NIYOGIKUNDIRO PASCALINE","NIYOMUKIZA ANYSIA","NIYO NGENZI DAVE FRIEND","NKURUNZIZA INEZA Messi","NSENGIMANA Benjamin","NTIVUGURUZWA Samuel","RUKUNDO Djabil","SHAMI IRAKOZE ALLIANCE","SHEMA HAGUMA Prince Gabin","TETA MARIE CLAIRE","TETERO Lucie","UMUGANWA Hidaya Aisha","UMUKUMBURWA MPETA FIDELINE","UWOYIREMEYE Faida"],
      "S3B": ["AKIMANIZANYE AGNES","ASHIMWE Aime Gloria","DUSABIMANA NIYIGENA Aline","GIHOZO IRIZA ENOLLA","HAKIZUMWAMI Samuel","HIRWA MANZI HAPPINESS","IGIRANEZA ESTHER","IHIRWE NSHUTI Ian Jadyne","IKUZO ELLA","IKUZWE ADUHIRE Louange","INEMA SYLVIA HEAVEN","INEZA NSHUTI HERVE","INEZA Peace","INGABIRE Ines","IRAGENA CYIZA Belyse","KATUSIME Jeanne d'Arc","MIZERO Aliane","MUGABEKAZI Parfaite","MUHAWENIMANA Nadine","MUNEZERO  ROSINE","MUSENGIMANA Ella Joy","MUTESA NELICKY","NGANZO Nalada","NIRAGIRE MIGNONE","NIYIGENA MUCYO MERCI MAXIME","NIYONGIRA Rene","NIYUBAHWE BIRORI Gloria","NTWALI SHEMA Honore","PENDA Oceanne Pamella","TUYISHIMIRE KEVINE","UMUBYEYI SENGA Benigne","UMUHIRE  Keza Odreille","UMWARI FIONA","UMWARI Natasha","UWIZEYE IRASUBIZA ERNESTINE"],
      "L3 SWD": ["ABIZERIMANA Benitha","AHISHAKIYE Janvier","BYIRINGIRO Eric","CYUBAHIRO Jackson","CYUZUZO Isaac","GIKUNDIRO Sandrine","HABIMANA Hamis","IBYIZA Speratha","IGIHOZO Frorence","INEZA MUGISHA Landry","INEZA TETA Gloria","IRABIZI Bowaze","IRAGENA Sendrine","IRASUBIZA Emille","IZABAYO Yves","KURUGISHURI Samson","KWIZERA Gad","MANISHIMWE Jean de Dieu","MUGISHA Brian","MUGISHA Isaac","MUNEZERO Danny","MUSHIMIYIMANA Marie Reine","MUSHIMIYIMANA Sumaya","MUSINGUZI Emmanuel","NDUWAYEZU Theophile","NIRAGIRE Daphine","NISHIMIRWE ISUBIRIZIGIHE Dani","NIWEMUGENI Liliane","NIYOGUSHIMWA Ange Christian","NIYONASENZE Beulla","NIYONKURU Vradimir","NYISHIMENTE Naome Nadine","TUGIRINSHUTI Evariste","TURINIMANA Augustin","TUYISHIMIRE Solange","UWUMUGISHA Pacifique","UMUTOZO Eduige","UMWARI Josiane","UWAMAHORO Ange UWASE","UWIDUHAYE Theodette","UWIMBABAZI Lydie","UWIMPUHWE Nadia","UWINGENEYE Claire"],
      "S4A": ["ABERA Esther","ABIJURU Josiane","BYIRINGIRO Justine","IGIZENEZA Divine","INEZA Alliance Benie","INGABIRE KAYIBANDA Germaine","IRAGENA KAYIRANGWA Elysa","IRAGENA Solange","IRAKOZE Aime","IRAKOZE Pascaline","ISHIMWE Fabrice","ISHIMWE TUYISENGE Emma","ISHIMWE Velentine","ITUZE GWIZA Sabrine","KAMIKAZI Derlene","KEZA EPA","MASEZERANO Fabrice","MBARUTSO IKUNDWE Bertin","MINAKUZESA Amina","MUCYO Ignace Omega","MUGABE Robert","MUKAHIRWA Julienne","MUKIRE WINNY Nicole","MUKUNDWA Faith","MUNEZERO Clemence","MUSHIMIYIMANA Angelique","MUTAMBA Xenie","NAMAHIRWE Ebenizelle","NDAYIZEYE Angelique","NIYOBYOSE Revelien","NIYONAMBAZA Elina","NYIHANZAMASO Yvette","NYIRAMUGISHA Berthilde","NYIRANSENGIYUMVA Aliance","NZAYISENGA Vanessa","SHIMIRWA Caline","TUMUSHIME Vedaste","TUYISHIMIRE Divine","TWAGIRIMANA Riberee","UMUGWANEZA Pascaline","UWAMARIYA Enysia","UWASE KABUGO Aline","UWASE Nicole","UWIMANA Odila"],
      "S4B": ["AKIMANA Cecile","AMIZERO Nadine","ASHIMIMANA Clementine","BAHATI Cleb","GAHONGAYIRE Pauline","GIKUNDIRO TUMUKUNDE Emelyne","HIRWA Bertin","HIRWA Fabrice","HUMURIZIBYOSE Ange","IGIRANEZA David","IGIRIMBABAZI Emelyne","INEZA Joy","INEZA Veronique","IRADUKUNDA Immaculee","IRADUKUNDA Rahab","IRAKOZE Marlene","IRANZI Aime","MUHAWENIMANA Noella","MUKESHIMANA Jeannette","MUNYANA Kellen","MUSHIMIYIMANA Henriette","MUTONI Queen","NIYONIZEYE Jean d'Amour","NIZIGIYIMANA Banjamin","NSHIMIYUMUKIZA Liliane","TUMUKUNDE Kevine","TURATSINZE Emmanuel","TUYAMBAZE Beatha","TUYISHIMIRE Marie Grace","UMUGWANEZA Beyonce","UMUGWANEZA Scovia","UMUKUNDWA Kelly","UMUTONI Pascaline","UMUTONIWASE Blandine","UWAMAHORO Zawadi","UWASE Jeannine","UWASE SANGWA Kevine","UWAYEZU Fiacrine","UWAYO Ester","UWIMANA Alice","UWIZEYIMANA Odette","UWIZEYIMANA Sarah"],
      "L4 SWD": ["BIRORI Honorine","CYUZUZO Emile","DUSABE Anne Peline","GIKUNDIRO Shalom","GISUBIZO HIRWA Bonheur","GISUBIZO Jean Claude","IBANENATWE Gisele","INEZA Alida","IRADUKUNDA Josiane","IRAKOZE Hyacinthe","IRANKUNDA Pacifique","IRANZI Naome","IRUMVA HIRWA Arsene","ISHEMA Christian","ISHIMWE Jeanne Gentille","ISIMBI Golden","IZABAYO Emeritha","KWIZERA Derick","MUGISHA Aime Kevin","MUGISHA Arnold","MUNEZA Hillo Blandeco","MUPENZI Cedrick","NDAHIDWA Arnould","NDATIMANA Dodoce","NDIZIHIWE Alain Delys","NIRERE Evangeline","NISHIMWE Olive","NIYO Esther Kevine","NSHIMIYIMANA  Dominique","NTAGARAMA Teta Cynthia","NYIRAGUHIRWA Kevine","NYIRAMANA Jeanne","SHYAKA Clever Prince","TONY RAY Hilde","TURINAYO AMANI Basil","UMWIZERWA Sandrine","USANASE Benitha","UWASE Belyse","UWASE Gloria","WIBABARA Janici"],
      "S5A": ["AHISHAKIYE Annualithe","BYUKUSENGE Adeline","GIKUNDIRO Kessia","HAVUGIMANA Girbert","IGIRANEZA Dorcas","INGABIRE Sifa","IRADUKUNDA Confiance","IRAGANJE Thanks","IRAKOZE Dorcas","IYAMUMPAYE  Julienne","KANGUME Ines","MUGANWA Fulgence","MUKAHIRWA Benitha","MUKIZA  Leonce","MUSANGANYA Elyse","MUTONIWASE  Delphine","NDAYISHIMIYE Lambert","NIYIBIZI Samuel","NIYIDUHA  Carine","NIYINGABIRA Evelyne","TETA REPONSE  Meghan","UNEZEREWE  Ange Sharom","UWASE BWANAKWELI Scovia","UWASE Pauline","UWITUZE Sandrine","UWURUKUNDO Rosine","ZIGIRIMENA Darlene"],
      "S5B": ["CYUZUZO  Angel","CYUZUZO Ange Benigne","DUSHIMIMANA Jehovajureh","DUSHIMIYIMANA  Rosine","DUSINGIZIMANA Queen","IRADUHAYE Bless","ISHIMO AKARIZA Ange Sabrine","ISHIMWE  Fabiola Aime","ISHIMWE  Cynthia","ISHIMWE Clarisse","ISHIMWE Frank","ISHIMWE MPANO Honoline","IYONASENZE Bonheur","MANIRATANGA Elie","MANIRIHO  Jean Paul","NAMUKUNDIYICYO Pascaline","NIYONSHUTI Bruno","NIYUBAHWE Giselle","NTWARI NZABARINDA Guillaume","NYIRABAGENI Leonille","TUYIKUNDE  Marie Ange","UMWARIWASE Stella Divine","UWAMAHORO HIRWA Berthe","UWAMURERA Anitha","UWIDUHAYE Belise","UWIHANGANYE  Ezechiel"],
      "S6A": ["BENIHIRWE DATIVE","DUSABIRANE DORCAS","IFASHUWACU KEVINE","IMFURANASE AIME PATRICK","INGABIRE DIVINE","IRAKARAMA NATALIE","KABATESI PHIONAH","MUHONGERWA DIANE","MUKAMABANO Agnes","MUKAMUGABO LILIANE","MUKAMUGISHA DEVOTHE","MUKARUKUNDO CLARISSE","MUKESHIMANA MICHELINE","MUNEZERO DENYSE","MUREKAZE GAUDENCE","MUSHIMIYIMANA CLAUDINE","MUTEZIMANA ANGELINA","MUTUYIMANA ANITHA","NISHIMWE UWIJURU ESTHER","NIYIKORA DELIPHINE","NIYITANGINGABIRE LAURENCE","NIYOMUTABAZI ISMAEL","NIYONGIRA INNOCENT","NIYONSENGA CLARISSE","PRINCE Anathole Nobel","SANGWA EDEN SHALOM","TUMUSIFU EVANGELINE","TUYISHIME Eliane","TUYIZERE Marie Ange","UMUHUZA HELENE","UMURISA HOGOZA Benize","UMUTONI Alice","UMUTONIWASE STEPHANIE","UMUTONIWASE enatha","UWABEZA Charlotte","UWAMAHORO BEATHA","UWAMBAJIMANA DIANE","UWINEZA JOSIANE","UWINEZA Henriette","UWIRAGIYE Joselyne","UWUMUGISHA Consolee"],
      "S6B": ["AHIMBAZWE CONSTANT","AKURUKUNDO Adeline","DUSHIMIMANA Albine","DUSINGIZIMANA Monica","DUSINGIZIMANA Faustine","GASARO Lucky","IRATUZI PRINCE","ISHIMWE Clementine","IYAMUDUHAYE FORTUNEE","KAYESU HOPE","KAYESU FLORENCE","KIREZI ANGEL","MUGANWA JOYCE","MUGENIWAYEZU HENRIETTE","MUHAWIMANA Aline","MUHORAKEYE ALLIANCE","MUKANDAYISHIMIYE Sylivie","MUTIMAWURUGO ESTHER","MUTONIWASE Bella","NDACYAYISENGA ANITHA","NDAYISHIMIYE SAMUEL","NIKUZE Jean Pierre","NIRERE LOUISE","NIYINDEMERA MUTABARUKA Eunice Helena","NIYINGENERA JOYEUSE","NIYOKWIZERWA LILIANE","NIYONAGIZE AZELE","NYAMPINGA PROVIDENCE","NYIRAKANYANA Sandrine","NYIRANIZEYIMANA Clesence","NYIRIMBABAZI Olive","TUYISENGE SANDRINE","UMURORA JOSIANE","UWAYISENGA ESPERANCE","UWERA Diane","UWIDUHAYE CHARITE","UWINEZA Jeanne d'Arc","UWINGABIRE Albertine","UWIZESERANO SANDRINE","UWONKUNDA Henriette","YEBARE PHIONAH"]
    };

    // Load draft results from localStorage or initialize new
    let students = JSON.parse(localStorage.getItem('draftResults')) || [];
    if (students.length === 0) {
      Object.keys(initial).forEach(cls => {
        initial[cls].forEach((name, i) => {
          students.push({ id: cls + '-' + (i+1), name, cls, midTerm: 0, t1: 0, t2: 0, t3: 0, termExam: 0 });
        });
      });
    }

    const classesContainer = document.getElementById('classesContainer');
    const msg = document.getElementById('message');
    const searchInput = document.getElementById('studentSearch');
    const searchResults = document.getElementById('searchResults');
    const midTermBtn = document.getElementById('midTermBtn');
    const term1Btn = document.getElementById('term1Btn');
    const term2Btn = document.getElementById('term2Btn');
    const term3Btn = document.getElementById('term3Btn');
    const termExamBtn = document.getElementById('termExamBtn');
    const saveBtn = document.getElementById('saveBtn');

    let currentField = 'midTerm'; // Default to mid-term

    function saveDraft() {
      localStorage.setItem('draftResults', JSON.stringify(students));
    }

    function updateTermButtons() {
      // Reset all buttons
      [midTermBtn, term1Btn, term2Btn, term3Btn, termExamBtn].forEach(btn => {
        btn.classList.remove('active', 'bg-blue-600', 'text-white');
        btn.classList.add('text-blue-600');
      });

      // Activate current button
      const activeBtn = document.getElementById(currentField + 'Btn');
      activeBtn.classList.add('active', 'bg-blue-600', 'text-white');
      activeBtn.classList.remove('text-blue-600');
    }

    function render() {
      // Group classes by year
      const yearGroups = {};
      Object.keys(initial).forEach(cls => {
        const year = cls.match(/^([SL]\d+)/)[1]; // Extract S1, S2, etc.
        if (!yearGroups[year]) yearGroups[year] = [];
        yearGroups[year].push(cls);
      });

      const groups = {};
      students.forEach(s => {
        if (!groups[s.cls]) groups[s.cls] = [];
        groups[s.cls].push(s);
      });

      classesContainer.innerHTML = '';
      Object.keys(yearGroups).sort().forEach(year => {
        const box = document.createElement('div');
        box.className = 'border rounded p-3 year-box';
        box.innerHTML = `
          <h3 class="font-semibold text-blue-700 mb-2 flex justify-between items-center">
            ${year} <span class="text-gray-500 text-sm">(${yearGroups[year].reduce((sum, cls) => sum + groups[cls].length, 0)} students)</span>
            <span class="text-blue-600">▼</span>
          </h3>
          <div class="class-list hidden">
            ${yearGroups[year].sort().map(cls => `
              <div class="mb-4">
                <h4 class="font-semibold text-blue-600 mb-2">${cls} (${groups[cls].length} students)</h4>
                <div class="overflow-auto">
                  <table class="w-full text-sm">
                    <thead><tr class="text-left text-xs text-gray-600">
                      <th class="pb-2">Student</th>
                      <th class="pb-2">${getFieldDisplayName(currentField)} (/100)</th>
                    </tr></thead>
                    <tbody>
                      ${groups[cls].map(s => `
                        <tr class="border-t">
                          <td class="py-1">${s.name}</td>
                          <td>
                            <input type="number" min="0" max="100" value="${s[currentField]}" 
                                   data-id="${s.id}" data-field="${currentField}" 
                                   class="border rounded w-20 px-2 py-1 text-sm mark-input" />%
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>
            `).join('')}
          </div>`;
        classesContainer.appendChild(box);
        box.querySelector('h3').addEventListener('click', () => {
          const classList = box.querySelector('.class-list');
          const arrow = box.querySelector('h3 span');
          classList.classList.toggle('hidden');
          arrow.textContent = classList.classList.contains('hidden') ? '▼' : '▲';
        });
      });

      // Attach event listeners to input fields
      document.querySelectorAll('.mark-input').forEach(input => {
        input.addEventListener('change', () => {
          update(input.dataset.id, input.dataset.field, input.value);
        });
      });
    }

    function getFieldDisplayName(field) {
      const names = {
        'midTerm': 'Mid-Term',
        't1': 'Term 1',
        't2': 'Term 2',
        't3': 'Term 3',
        'termExam': 'Term Exam'
      };
      return names[field] || field;
    }

    function update(id, field, value) {
      const s = students.find(x => x.id === id);
      let v = Number(value) || 0;
      if (v > 100) v = 100;
      if (v < 0) v = 0;
      s[field] = v;
      saveDraft();
    }

    function searchStudent(query) {
      searchResults.innerHTML = '';
      if (query.trim() === '') return;
      
      const results = students.filter(s => 
        s.name.toLowerCase().includes(query.toLowerCase())
      );

      if (results.length === 0) {
        searchResults.innerHTML = '<p class="text-sm text-gray-600">No students found.</p>';
        return;
      }

      results.forEach(s => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'border rounded p-3 mb-2';
        resultDiv.innerHTML = `
          <h4 class="font-semibold text-blue-700">${s.name} (${s.cls})</h4>
          <p class="text-sm">Mid-Term: ${s.midTerm}%</p>
          <p class="text-sm">Term 1: ${s.t1}%</p>
          <p class="text-sm">Term 2: ${s.t2}%</p>
          <p class="text-sm">Term 3: ${s.t3}%</p>
          <p class="text-sm">Term Exam: ${s.termExam}%</p>
        `;
        searchResults.appendChild(resultDiv);
      });
    }

    // Event listeners for term navigation buttons
    midTermBtn.addEventListener('click', () => {
      currentField = 'midTerm';
      updateTermButtons();
      render();
    });

    term1Btn.addEventListener('click', () => {
      currentField = 't1';
      updateTermButtons();
      render();
    });

    term2Btn.addEventListener('click', () => {
      currentField = 't2';
      updateTermButtons();
      render();
    });

    term3Btn.addEventListener('click', () => {
      currentField = 't3';
      updateTermButtons();
      render();
    });

    termExamBtn.addEventListener('click', () => {
      currentField = 'termExam';
      updateTermButtons();
      render();
    });

    searchInput.addEventListener('input', () => {
      searchStudent(searchInput.value);
    });

    saveBtn.addEventListener('click', () => {
      saveDraft();
      msg.classList.remove('hidden');
      msg.textContent = "✅ All changes saved successfully!";
      msg.scrollIntoView({ behavior: 'smooth', block: 'center' });
      setTimeout(() => msg.classList.add('hidden'), 4000);
    });

    // Initialize
    updateTermButtons();
    render();
  </script>

  <script src="https://kit.fontawesome.com/a2e8b3b7d5.js" crossorigin="anonymous"></script>
</body>
</html>