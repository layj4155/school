<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kageyo TVET — Discipline Management</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .card { border-radius: .75rem; box-shadow: 0 8px 24px rgba(2,6,23,0.06); }
        .publish-bar { position: sticky; bottom: 0; background: white; z-index: 40; border-top:1px solid rgba(0,0,0,0.06); }
        .nav-card { transition: all 0.3s ease; }
        .nav-card:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(2,6,23,0.1); }
        .student-card { transition: all 0.2s ease; cursor: pointer; }
        .student-card:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .violation-item { border-left: 4px solid transparent; }
        .violation-item.late { border-left-color: #f59e0b; }
        .violation-item.uniform { border-left-color: #ef4444; }
        .violation-item.disruptive { border-left-color: #8b5cf6; }
        .violation-item.homework { border-left-color: #10b981; }
        .violation-item.disrespect { border-left-color: #dc2626; }
        .violation-item.fighting { border-left-color: #7c3aed; }
        .violation-item.other { border-left-color: #6b7280; }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="bg-blue-600 text-white py-2">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <a href="#" class="hover:underline"><i class="fab fa-whatsapp mr-2"></i>Join WhatsApp Group</a>
                <select class="p-1 rounded bg-white text-blue-600">
                    <option value="en">English</option>
                    <option value="rw">Kinyarwanda</option>
                    <option value="fr">Français</option>
                </select>
            </div>
        </div>

        <div class="container mx-auto px-4 py-4">
            <nav class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href='index.html'>
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-school text-blue-600 text-2xl"></i>
                        </div>
                    </a>
                    <div>
                        <div class='text-xl font-bold text-blue-600'>KAGEYO TVET SCHOOL</div>
                        <div class="text-sm text-gray-500">Work - Courage - Solidarity</div>
                    </div>
                </div>

                <div class="hidden md:flex items-center space-x-6">
                    <a class='text-blue-600 hover:text-blue-800' href='/'>Home</a>
                    <a class='text-blue-600 hover:text-blue-800' href='/about'>About Us</a>
                    <a href="student-data.html" class="text-blue-600 hover:text-blue-800">Student Portal</a>
                    <a class='text-blue-600 hover:text-blue-800' href='/contact'>Contact</a>
                    <a class='px-3 py-2 bg-blue-600 text-white rounded' href='/login-new'>Login</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <section class="card bg-white p-6">
            <div class="flex items-start justify-between mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-blue-700">Disciplinary Records Management</h1>
                    <p class="text-sm text-gray-600">Students start with 40 marks per term. Record violations to deduct marks.</p>
                </div>
                <div class="text-right text-sm text-gray-500">
                    Academic Year: <strong>2025 - 2026</strong>
                </div>
            </div>

            <!-- Navigation Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="nav-card bg-white border border-blue-200 rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-clock text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-blue-700 mb-2">Term 1 Discipline</h3>
                    <p class="text-sm text-gray-600 mb-4">Manage disciplinary records for Term 1</p>
                    <button onclick="showTerm('term1')" class="inline-block px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        Manage Term 1
                    </button>
                </div>

                <div class="nav-card bg-white border border-green-200 rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-graduate text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-green-700 mb-2">Term 2 Discipline</h3>
                    <p class="text-sm text-gray-600 mb-4">Manage disciplinary records for Term 2</p>
                    <button onclick="showTerm('term2')" class="inline-block px-6 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors">
                        Manage Term 2
                    </button>
                </div>

                <div class="nav-card bg-white border border-purple-200 rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-check text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-purple-700 mb-2">Term 3 Discipline</h3>
                    <p class="text-sm text-gray-600 mb-4">Manage disciplinary records for Term 3</p>
                    <button onclick="showTerm('term3')" class="inline-block px-6 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors">
                        Manage Term 3
                    </button>
                </div>
            </div>

            <!-- Quick Overview -->
            <div class="mb-8">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Disciplinary Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="text-blue-600 font-semibold text-2xl" id="totalStudents">0</div>
                        <div class="text-sm text-gray-600">Total Students</div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="text-green-600 font-semibold text-2xl" id="classesCount">0</div>
                        <div class="text-sm text-gray-600">Classes</div>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="text-yellow-600 font-semibold text-2xl" id="term1Violations">0</div>
                        <div class="text-sm text-gray-600">Term 1 Violations</div>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <div class="text-purple-600 font-semibold text-2xl" id="term2Violations">0</div>
                        <div class="text-sm text-gray-600">Term 2 Violations</div>
                    </div>
                </div>
            </div>

            <!-- Term Management Sections -->
            <div id="term1Section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-blue-700">Term 1 Disciplinary Records</h2>
                    <button onclick="showOverview()" class="text-blue-600 hover:text-blue-800 flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Overview
                    </button>
                </div>
                <div id="term1Content"></div>
            </div>

            <div id="term2Section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-green-700">Term 2 Disciplinary Records</h2>
                    <button onclick="showOverview()" class="text-green-600 hover:text-green-800 flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Overview
                    </button>
                </div>
                <div id="term2Content"></div>
            </div>

            <div id="term3Section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-purple-700">Term 3 Disciplinary Records</h2>
                    <button onclick="showOverview()" class="text-purple-600 hover:text-purple-800 flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Overview
                    </button>
                </div>
                <div id="term3Content"></div>
            </div>

            <!-- Recent Activity -->
            <div id="overviewSection">
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-700 mb-3">Recent Disciplinary Actions</h3>
                    <div id="recentActivity" class="text-sm text-gray-600">
                        <!-- Activity will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="publish-bar p-4 mt-8">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-700">Once all disciplinary records are updated, click the button below to publish results.</div>
                    <div class="space-x-2">
                        <button id="resetBtn" class="bg-red-600 text-white px-5 py-2 rounded font-semibold hover:bg-red-700">Reset All Records</button>
                        <button id="publishAllBtn" class="bg-blue-600 text-white px-5 py-2 rounded font-semibold hover:bg-blue-700">Publish Results</button>
                    </div>
                </div>
                <div id="message" class="text-green-600 text-sm font-medium mt-2 hidden"></div>
            </div>
        </section>
    </main>

    <!-- Student Details Modal -->
    <div id="studentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-2xl max-h-[90vh] overflow-hidden">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-800" id="modalTitle">Student Disciplinary Record</h3>
                <button onclick="closeStudentModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-4 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="studentDetails" class="fade-in">
                    <!-- Student details will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initial student data
        const initial = {
            "S1A": ["ABEREYIMANA James","ABIMANA HIRWA Gany Blessing","AHISHAKIYE MANZI Aime Miguel","ASHIMWE Nate Brayan","Benedicto King Samuel","BUGINGO BEZA Keny"],
            "S1B": ["ABAYISENGA Emmu Shalom","AMANI NSHUTI Claver","ARERWENEZA Laetitia","BAGABE Dieudonne","CYOMORO Nicky Prince","GAGA Lioness"],
            "S2A": ["BYISHIMO Remy","BAHO AKARIZA Kevine","DUKUZUMUREMYI Janvier","GANZA AHADI TRESOR","IHIRWE Benitha","IKUNDABAYO Kevin"],
            "S2B": ["ABE MUGISHA Antoine","ABIJURU Gift Kelly Joel","AGASARO Liza Briante","CYOMORO NIYONZIMA Iba Bright","GIRUMUGISHA MASSIMO","HERO KARENGERA Keutch"],
            "S3A": ["ABAYO Samuella","BYIRINGIRO GWIZA SALOMON","IGIHOZO EVA ALLEN QUEEN","IGIZENEZA Benoit Gratus","IHIRWE FLORA","IHOZO Carine"],
            "S3B": ["AKIMANIZANYE AGNES","ASHIMWE Aime Gloria","DUSABIMANA NIYIGENA Aline","GIHOZO IRIZA ENOLLA","HAKIZUMWAMI Samuel","HIRWA MANZI HAPPINESS"]
        };

        // Violation types with default mark deductions
        const violationTypes = {
            "Late arrival": { marks: 2, color: "late", icon: "fa-clock" },
            "Untidy uniform": { marks: 2, color: "uniform", icon: "fa-tshirt" },
            "Disruptive behavior": { marks: 5, color: "disruptive", icon: "fa-volume-up" },
            "Missing homework": { marks: 3, color: "homework", icon: "fa-book" },
            "Disrespect to staff": { marks: 10, color: "disrespect", icon: "fa-user-times" },
            "Fighting": { marks: 15, color: "fighting", icon: "fa-fist-raised" },
            "Other": { marks: 0, color: "other", icon: "fa-exclamation-circle" }
        };

        // Load disciplinary records from localStorage or initialize new
        let students = JSON.parse(localStorage.getItem('disciplineRecords')) || [];
        let selectedStudent = null;
        let currentTerm = "";

        // Initialize students if empty
        if (students.length === 0) {
            Object.keys(initial).forEach(cls => {
                initial[cls].forEach((name, i) => {
                    students.push({
                        id: cls + '-' + (i+1),
                        name,
                        cls,
                        // Each term starts with 40 marks
                        term1: 40,
                        term2: 40,
                        term3: 40,
                        // Violations array for each term
                        violations: {
                            term1: [],
                            term2: [],
                            term3: []
                        }
                    });
                });
            });
            saveRecords();
        }

        const msg = document.getElementById('message');

        function updateStats() {
            // Calculate statistics
            const totalStudents = students.length;
            const classesCount = Object.keys(initial).length;
            
            let term1Violations = 0;
            let term2Violations = 0;
            let term3Violations = 0;
            
            students.forEach(student => {
                term1Violations += student.violations.term1.length;
                term2Violations += student.violations.term2.length;
                term3Violations += student.violations.term3.length;
            });
            
            // Update UI
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('classesCount').textContent = classesCount;
            document.getElementById('term1Violations').textContent = term1Violations;
            document.getElementById('term2Violations').textContent = term2Violations;
            
            // Update recent activity
            const recentActivity = document.getElementById('recentActivity');
            recentActivity.innerHTML = '';
            
            // Get recent violations (last 5)
            const allViolations = [];
            students.forEach(student => {
                ['term1', 'term2', 'term3'].forEach(term => {
                    student.violations[term].forEach(violation => {
                        allViolations.push({
                            ...violation,
                            studentName: student.name,
                            studentClass: student.cls,
                            term
                        });
                    });
                });
            });
            
            // Sort by date (newest first)
            allViolations.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Display recent 5
            const recent = allViolations.slice(0, 5);
            if (recent.length === 0) {
                recentActivity.innerHTML = '<p class="text-gray-500 italic">No disciplinary violations recorded yet.</p>';
            } else {
                recent.forEach(violation => {
                    const item = document.createElement('div');
                    item.className = 'border-b border-gray-200 py-2 last:border-0';
                    item.innerHTML = `
                        <div class="flex justify-between">
                            <span class="font-medium">${violation.studentName}</span>
                            <span class="text-xs text-gray-500">${violation.date}</span>
                        </div>
                        <div class="text-sm text-gray-600 flex items-center">
                            <i class="fas ${violationTypes[violation.type].icon} mr-2 text-${violationTypes[violation.type].color}-500"></i>
                            ${violation.type} (-${violation.marks} marks)
                        </div>
                    `;
                    recentActivity.appendChild(item);
                });
            }
        }

        function saveRecords() {
            localStorage.setItem('disciplineRecords', JSON.stringify(students));
            updateStats();
        }

        function showTerm(term) {
            currentTerm = term;
            
            // Hide all sections
            document.getElementById('overviewSection').classList.add('hidden');
            document.getElementById('term1Section').classList.add('hidden');
            document.getElementById('term2Section').classList.add('hidden');
            document.getElementById('term3Section').classList.add('hidden');
            
            // Show selected term section
            document.getElementById(term + 'Section').classList.remove('hidden');
            
            // Populate term content
            populateTermContent(term);
        }

        function showOverview() {
            // Hide all term sections
            document.getElementById('term1Section').classList.add('hidden');
            document.getElementById('term2Section').classList.add('hidden');
            document.getElementById('term3Section').classList.add('hidden');
            
            // Show overview
            document.getElementById('overviewSection').classList.remove('hidden');
            
            currentTerm = "";
        }

        function populateTermContent(term) {
            const contentDiv = document.getElementById(term + 'Content');
            contentDiv.innerHTML = '';
            
            // Group students by class
            const classes = {};
            students.forEach(student => {
                if (!classes[student.cls]) {
                    classes[student.cls] = [];
                }
                classes[student.cls].push(student);
            });
            
            // Create class sections
            Object.keys(classes).sort().forEach(cls => {
                const classSection = document.createElement('div');
                classSection.className = 'mb-8';
                classSection.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">${cls}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="${cls.replace(' ', '')}Students">
                    </div>
                `;
                contentDiv.appendChild(classSection);
                
                // Add students for this class
                const studentsContainer = document.getElementById(cls.replace(' ', '') + 'Students');
                classes[cls].forEach(student => {
                    const studentCard = document.createElement('div');
                    studentCard.className = 'student-card bg-white border border-gray-200 rounded-lg p-4';
                    studentCard.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-800">${student.name}</h4>
                                <p class="text-sm text-gray-600">${student.cls}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold ${student[term] >= 30 ? 'text-green-600' : student[term] >= 20 ? 'text-yellow-600' : 'text-red-600'}">
                                    ${student[term]}/40
                                </div>
                                <div class="text-xs text-gray-500">${student.violations[term].length} violations</div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <button onclick="openStudentModal('${student.id}', '${term}')" class="w-full bg-blue-100 text-blue-700 py-1 rounded text-sm font-medium hover:bg-blue-200 transition-colors">
                                Manage Violations
                            </button>
                        </div>
                    `;
                    studentsContainer.appendChild(studentCard);
                });
            });
        }

        function openStudentModal(studentId, term) {
            selectedStudent = students.find(s => s.id === studentId);
            currentTerm = term;
            
            document.getElementById('modalTitle').textContent = `${selectedStudent.name} - ${term.toUpperCase()} Disciplinary Record`;
            document.getElementById('studentModal').classList.remove('hidden');
            
            populateStudentDetails();
        }

        function closeStudentModal() {
            document.getElementById('studentModal').classList.add('hidden');
            selectedStudent = null;
        }

        function populateStudentDetails() {
            const studentDetails = document.getElementById('studentDetails');
            studentDetails.innerHTML = '';
            
            if (!selectedStudent) return;
            
            // Student info
            const infoSection = document.createElement('div');
            infoSection.className = 'mb-6 p-4 bg-gray-50 rounded-lg';
            infoSection.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-lg text-gray-800">${selectedStudent.name}</h4>
                        <p class="text-gray-600">${selectedStudent.cls} • ID: ${selectedStudent.id}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold ${selectedStudent[currentTerm] >= 30 ? 'text-green-600' : selectedStudent[currentTerm] >= 20 ? 'text-yellow-600' : 'text-red-600'}">
                            ${selectedStudent[currentTerm]}/40
                        </div>
                        <div class="text-sm text-gray-500">Remaining Marks</div>
                    </div>
                </div>
            `;
            studentDetails.appendChild(infoSection);
            
            // Add violation section
            const violationSection = document.createElement('div');
            violationSection.className = 'mb-6';
            violationSection.innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-3">Record New Violation</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    ${Object.keys(violationTypes).map(type => `
                        <button onclick="addViolation('${type}')" class="p-3 border border-gray-200 rounded-lg text-left hover:bg-gray-50 transition-colors">
                            <div class="flex items-center">
                                <i class="fas ${violationTypes[type].icon} text-${violationTypes[type].color}-500 mr-3"></i>
                                <div>
                                    <div class="font-medium text-gray-800">${type}</div>
                                    <div class="text-sm text-gray-600">-${violationTypes[type].marks} marks</div>
                                </div>
                            </div>
                        </button>
                    `).join('')}
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Custom Violation</label>
                    <div class="flex">
                        <input type="text" id="customViolation" placeholder="Violation description" class="flex-1 p-2 border border-gray-300 rounded-l-md focus:ring-blue-500 focus:border-blue-500">
                        <input type="number" id="customMarks" min="1" max="40" placeholder="Marks" class="w-24 p-2 border-t border-b border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <button onclick="addCustomViolation()" class="bg-blue-600 text-white px-4 rounded-r-md hover:bg-blue-700">Add</button>
                    </div>
                </div>
            `;
            studentDetails.appendChild(violationSection);
            
            // Violation history
            const historySection = document.createElement('div');
            historySection.innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-3">Violation History</h4>
            `;
            
            const violations = selectedStudent.violations[currentTerm];
            if (violations.length === 0) {
                historySection.innerHTML += `<p class="text-gray-500 italic">No violations recorded for this term.</p>`;
            } else {
                violations.forEach((violation, index) => {
                    const violationItem = document.createElement('div');
                    violationItem.className = `violation-item ${violationTypes[violation.type].color} bg-white border border-gray-200 rounded-lg p-3 mb-2`;
                    violationItem.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex items-start">
                                <i class="fas ${violationTypes[violation.type].icon} text-${violationTypes[violation.type].color}-500 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-gray-800">${violation.type}</div>
                                    <div class="text-sm text-gray-600">${violation.description}</div>
                                    <div class="text-xs text-gray-500 mt-1">${violation.date}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-red-600 font-semibold">-${violation.marks}</div>
                                <button onclick="removeViolation(${index})" class="text-red-500 hover:text-red-700 mt-1">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    historySection.appendChild(violationItem);
                });
            }
            
            studentDetails.appendChild(historySection);
        }

        function addViolation(type) {
            if (!selectedStudent) return;
            
            const marks = violationTypes[type].marks;
            
            // Check if student has enough marks
            if (selectedStudent[currentTerm] - marks < 0) {
                showMessage(`Cannot deduct ${marks} marks. Student only has ${selectedStudent[currentTerm]} marks remaining.`, 'error');
                return;
            }
            
            // Record the violation
            const violation = {
                type: type,
                marks: marks,
                description: type,
                date: new Date().toISOString().split('T')[0]
            };
            
            selectedStudent.violations[currentTerm].push(violation);
            selectedStudent[currentTerm] -= marks;
            
            // Save and update UI
            saveRecords();
            populateStudentDetails();
            
            showMessage(`Violation recorded successfully. ${marks} marks deducted.`);
        }

        function addCustomViolation() {
            if (!selectedStudent) return;
            
            const description = document.getElementById('customViolation').value;
            const marks = parseInt(document.getElementById('customMarks').value);
            
            if (!description || !marks || marks <= 0) {
                showMessage('Please provide both a description and valid number of marks.', 'error');
                return;
            }
            
            // Check if student has enough marks
            if (selectedStudent[currentTerm] - marks < 0) {
                showMessage(`Cannot deduct ${marks} marks. Student only has ${selectedStudent[currentTerm]} marks remaining.`, 'error');
                return;
            }
            
            // Record the violation
            const violation = {
                type: "Other",
                marks: marks,
                description: description,
                date: new Date().toISOString().split('T')[0]
            };
            
            selectedStudent.violations[currentTerm].push(violation);
            selectedStudent[currentTerm] -= marks;
            
            // Save and update UI
            saveRecords();
            populateStudentDetails();
            
            // Clear inputs
            document.getElementById('customViolation').value = '';
            document.getElementById('customMarks').value = '';
            
            showMessage(`Custom violation recorded successfully. ${marks} marks deducted.`);
        }

        function removeViolation(index) {
            if (!selectedStudent || !confirm('Are you sure you want to remove this violation?')) return;
            
            const violation = selectedStudent.violations[currentTerm][index];
            
            // Restore marks
            selectedStudent[currentTerm] += violation.marks;
            
            // Remove violation
            selectedStudent.violations[currentTerm].splice(index, 1);
            
            // Save and update UI
            saveRecords();
            populateStudentDetails();
            
            showMessage(`Violation removed successfully. ${violation.marks} marks restored.`);
        }

        function showMessage(text, type = 'success') {
            msg.textContent = text;
            msg.className = type === 'success' ? 'text-green-600 text-sm font-medium mt-2' : 'text-red-600 text-sm font-medium mt-2';
            msg.classList.remove('hidden');
            setTimeout(() => {
                msg.classList.add('hidden');
            }, 3000);
        }

        function resetAllRecords() {
            if (confirm('Are you sure you want to reset all disciplinary records? This action cannot be undone.')) {
                students = [];
                Object.keys(initial).forEach(cls => {
                    initial[cls].forEach((name, i) => {
                        students.push({
                            id: cls + '-' + (i+1),
                            name,
                            cls,
                            term1: 40,
                            term2: 40,
                            term3: 40,
                            violations: {
                                term1: [],
                                term2: [],
                                term3: []
                            }
                        });
                    });
                });
                saveRecords();
                if (currentTerm) {
                    populateTermContent(currentTerm);
                }
                showMessage('All disciplinary records have been reset.');
            }
        }

        function publishResults() {
            showMessage('Disciplinary results have been published successfully.');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // Event listeners for action buttons
            document.getElementById('resetBtn').addEventListener('click', resetAllRecords);
            document.getElementById('publishAllBtn').addEventListener('click', publishResults);
        });
    </script>
</body>
</html>